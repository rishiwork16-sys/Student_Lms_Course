<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Admin</title>
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Student Management Styles */
        .student-mgmt-modal .modal-content {
            max-width: 750px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .student-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            transition: box-shadow 0.2s;
        }
        .student-card:hover { box-shadow: 0 4px 14px rgba(0,0,0,0.08); }
        .student-avatar {
            width: 48px; height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 700; font-size: 18px; flex-shrink: 0;
        }
        .student-info { flex: 1; min-width: 0; }
        .student-info h4 { margin: 0 0 2px; font-size: 15px; color: #1a202c; }
        .student-info p { margin: 0; font-size: 13px; color: #718096; }
        .student-actions { display: flex; gap: 8px; flex-shrink: 0; }
        .btn-sm {
            padding: 6px 14px; border-radius: 8px; border: none;
            font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .btn-sm.primary { background: #667eea; color: white; }
        .btn-sm.primary:hover { background: #5a67d8; }
        .btn-sm.danger { background: #fed7d7; color: #c53030; }
        .btn-sm.danger:hover { background: #feb2b2; }
        .btn-sm.success { background: #c6f6d5; color: #276749; }
        .btn-sm.success:hover { background: #9ae6b4; }

        .tab-bar { display: flex; gap: 4px; margin-bottom: 20px; border-bottom: 2px solid #e2e8f0; }
        .tab-btn {
            padding: 10px 20px; background: none; border: none; border-bottom: 3px solid transparent;
            cursor: pointer; font-size: 14px; font-weight: 600; color: #718096;
            margin-bottom: -2px; transition: all 0.2s;
        }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }

        .tab-pane { display: none; }
        .tab-pane.active { display: block; }

        .form-group { margin-bottom: 14px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #4a5568; margin-bottom: 5px; }
        .form-group input, .form-group select {
            width: 100%; padding: 9px 12px;
            border: 1.5px solid #e2e8f0; border-radius: 8px;
            font-size: 14px; outline: none; transition: border-color 0.2s;
            box-sizing: border-box;
        }
        .form-group input:focus, .form-group select:focus { border-color: #667eea; }

        .enrollment-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 14px; background: #f0fff4; border-radius: 8px;
            margin-bottom: 8px; border: 1px solid #c6f6d5;
        }
        .enrollment-item span { font-size: 14px; font-weight: 500; color: #22543d; }

        .add-student-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; border: none; padding: 10px 22px;
            border-radius: 10px; font-size: 14px; font-weight: 600;
            cursor: pointer; display: inline-flex; align-items: center; gap: 8px;
            margin-bottom: 18px; transition: opacity 0.2s;
        }
        .add-student-btn:hover { opacity: 0.9; }
        .students-search {
            width: 100%; padding: 10px 14px; border: 1.5px solid #e2e8f0;
            border-radius: 10px; font-size: 14px; margin-bottom: 16px;
            outline: none; box-sizing: border-box;
        }
        .students-search:focus { border-color: #667eea; }
        .empty-state { text-align: center; padding: 30px; color: #a0aec0; font-size: 15px; }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <div style="display:flex; align-items:center; gap:12px;">
                <i class="fas fa-graduation-cap"></i>
                <span>skilledUp</span>
            </div>
            <button class="nav-toggle" id="adminNavToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <ul class="sidebar-menu">
            <li class="active">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </li>
            <li>
                <i class="fas fa-book"></i>
                <span>Courses</span>
            </li>
            <li onclick="openStudentManageModal()">
                <i class="fas fa-user-graduate"></i>
                <span>Students</span>
            </li>
            <li class="logout-item" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </li>
        </ul>
    </div>

    <div class="main-content">
        <header class="dashboard-header">
            <div class="header-left">
                <h1>Hello, Admin ðŸ‘‹</h1>
                <p>Here's what's happening with your academy today.</p>
            </div>
            <div class="header-right">
                <button class="btn-new-course" onclick="openCreateModal()">
                    <i class="fas fa-plus"></i> New Course
                </button>
            </div>
        </header>

        <!-- Action Cards -->
        <div class="action-cards">
            <div class="action-card create-course" onclick="openCreateModal()">
                <div class="action-icon">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <div class="action-info">
                    <h3>Create Course</h3>
                    <p>Add a new course to your catalog</p>
                </div>
            </div>

            <div class="action-card manage-courses" onclick="scrollToCourses()">
                <div class="action-icon">
                    <i class="fas fa-layer-group"></i>
                </div>
                <div class="action-info">
                    <h3>Manage Courses</h3>
                    <p>Edit, delete, or update content</p>
                </div>
            </div>

            <div class="action-card students" onclick="openStudentManageModal()">
                <div class="action-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="action-info">
                    <h3>Students</h3>
                    <p>Add, manage & enroll students</p>
                </div>
            </div>
        </div>

        <!-- Overview Section -->
        <div class="section-header">
            <h2>Overview</h2>
        </div>
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">Loading...</div>
        </div>

        <!-- Recent Courses Section -->
        <div class="section-header">
            <h2>Recent Courses</h2>
        </div>
        <div class="courses-grid" id="coursesGrid">
            <!-- Courses loaded here -->
        </div>

        <details>
            <summary class="section-header" style="cursor: pointer; list-style: none;">
                <h2>Recent Payments</h2>
            </summary>
            <div class="payments-grid" id="paymentsGrid">
                <div class="stat-card">Loading...</div>
            </div>
        </details>
    </div>

    <!-- Create Course Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeCreateModal()">&times;</span>
            <h2>Create New Course</h2>
            <form id="createCourseForm">
                <!-- Basic Info -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Course Title *</label>
                    <input type="text" id="courseTitle" placeholder="e.g., Complete Web Development" required
                        style="width: 100%;">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Description</label>
                    <textarea id="courseDesc" placeholder="Brief description of the course" rows="3"
                        style="width: 100%;"></textarea>
                </div>

                <!-- Duration -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Duration (Months) *</label>
                    <input type="number" id="courseDuration" placeholder="e.g., 6" min="1" required
                        style="width: 100%;">
                </div>

                <!-- Course Type -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Course Type *</label>
                    <div style="display: flex; gap: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="courseType" value="free" id="courseTypeFree" checked
                                onchange="togglePriceFields()">
                            <span style="margin-left: 8px;">Free Course</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="courseType" value="paid" id="courseTypePaid"
                                onchange="togglePriceFields()">
                            <span style="margin-left: 8px;">Paid Course</span>
                        </label>
                    </div>
                </div>

                <!-- Price Fields (shown only for paid courses) -->
                <div id="priceFields"
                    style="display: none; margin-bottom: 15px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">MRP (â‚¹) *</label>
                            <input type="number" id="courseMrp" placeholder="999" min="0" step="0.01"
                                oninput="calculateDiscount()" style="width: 100%;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Selling Price (â‚¹)
                                *</label>
                            <input type="number" id="coursePrice" placeholder="499" min="0" step="0.01"
                                oninput="calculateDiscount()" style="width: 100%;">
                        </div>
                    </div>
                    <div id="discountDisplay" style="color: #10b981; font-weight: 600; font-size: 14px;"></div>
                </div>

                <!-- Category & Language -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Category</label>
                        <select id="courseCategory"
                            style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="">Select Category</option>
                            <option value="Programming">Programming</option>
                            <option value="Data Science">Data Science</option>
                            <option value="Web Development">Web Development</option>
                            <option value="Mobile Development">Mobile Development</option>
                            <option value="Design">Design</option>
                            <option value="Business">Business</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Language</label>
                        <select id="courseLanguage"
                            style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
                            <option value="">Select Language</option>
                            <option value="English">English</option>
                            <option value="Hindi">Hindi</option>
                            <option value="Hinglish">Hinglish (Hindi + English)</option>
                            <option value="Tamil">Tamil</option>
                            <option value="Telugu">Telugu</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <!-- Instructor -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Instructor Name</label>
                    <input type="text" id="courseInstructor" placeholder="e.g., John Doe" style="width: 100%;">
                </div>

                <!-- Thumbnail -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Thumbnail Image</label>
                    <input type="file" id="courseThumbnail" accept="image/*" style="width: 100%;">
                </div>

                <!-- Active Status -->
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="courseActive" checked>
                        <span style="margin-left: 8px;">Make course active immediately</span>
                    </label>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%;">Create Course</button>
            </form>
        </div>
    </div>

    <!-- =========================================
         STUDENT MANAGEMENT MODAL
    ========================================== -->
    <div id="studentManageModal" class="modal student-mgmt-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentManageModal')">&times;</span>
            <h2 style="margin-bottom:6px;"><i class="fas fa-user-graduate" style="color:#667eea;margin-right:10px;"></i>Student Management</h2>
            <p style="color:#718096;font-size:14px;margin-bottom:20px;">Add students, assign courses, and manage enrollments.</p>

            <!-- Tabs -->
            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchTab('tabStudentList', this)">
                    <i class="fas fa-list"></i> All Students
                </button>
                <button class="tab-btn" onclick="switchTab('tabAddStudent', this)">
                    <i class="fas fa-user-plus"></i> Add Student
                </button>
            </div>

            <!-- TAB: All Students -->
            <div id="tabStudentList" class="tab-pane active">
                <input type="text" class="students-search" id="studentSearchInput"
                    placeholder="ðŸ” Search by name, phone or email..."
                    oninput="filterStudentList(this.value)">
                <div id="studentListContainer">
                    <div class="empty-state"><i class="fas fa-spinner fa-spin"></i> Loading students...</div>
                </div>
            </div>

            <!-- TAB: Add Student -->
            <div id="tabAddStudent" class="tab-pane">
                <form id="addStudentForm" onsubmit="submitAddStudent(event)">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="newStudentName" placeholder="e.g., Rahul Sharma" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number * (used for OTP login)</label>
                        <input type="tel" id="newStudentPhone" placeholder="e.g., 9876543210" required>
                    </div>
                    <div class="form-group">
                        <label>Email (optional)</label>
                        <input type="email" id="newStudentEmail" placeholder="e.g., rahul@example.com">
                    </div>
                    <div class="form-group">
                        <label>Password (optional, for password-based login)</label>
                        <input type="password" id="newStudentPassword" placeholder="Leave blank for OTP-only login">
                    </div>
                    <button type="submit" class="btn-primary" style="width:100%; margin-top:6px;">
                        <i class="fas fa-user-plus"></i> Add Student
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Student Details + Enrollment Modal -->
    <div id="studentDetailsModal" class="modal student-mgmt-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('studentDetailsModal')">&times;</span>

            <div style="display:flex;align-items:center;gap:14px;margin-bottom:20px;">
                <div class="student-avatar" id="studentDetailAvatar">?</div>
                <div>
                    <h2 id="studentDetailName" style="margin:0 0 2px;">Student Name</h2>
                    <p id="studentDetailMeta" style="margin:0;color:#718096;font-size:14px;"></p>
                </div>
            </div>

            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchTab('tabEnrollments', this)">
                    <i class="fas fa-book"></i> Enrolled Courses
                </button>
                <button class="tab-btn" onclick="switchTab('tabAssignCourse', this)">
                    <i class="fas fa-plus-circle"></i> Assign Course
                </button>
            </div>

            <!-- Enrolled Courses -->
            <div id="tabEnrollments" class="tab-pane active">
                <div id="enrollmentListContainer">
                    <div class="empty-state"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
                </div>
            </div>

            <!-- Assign Course -->
            <div id="tabAssignCourse" class="tab-pane">
                <div class="form-group" style="margin-bottom:16px;">
                    <label>Select a Course to Assign</label>
                    <select id="assignCourseSelect" style="width:100%;padding:10px;border:1.5px solid #e2e8f0;border-radius:8px;font-size:14px;">
                        <option value="">-- Select Course --</option>
                    </select>
                </div>
                <button onclick="submitAssignCourse()" class="btn-primary" style="width:100%;">
                    <i class="fas fa-paper-plane"></i> Assign Course
                </button>
            </div>

            <!-- Delete student -->
            <div style="margin-top:24px;padding-top:16px;border-top:1px solid #fed7d7;">
                <button onclick="confirmDeleteStudent()" style="background:#fff5f5;color:#c53030;border:1.5px solid #fed7d7;padding:9px 18px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;width:100%;">
                    <i class="fas fa-trash"></i> Delete This Student
                </button>
            </div>
        </div>
    </div>

    <script src="../js/shared.js?v=3"></script>
    <script src="../js/admin.js?v=5"></script>
</body>

</html>